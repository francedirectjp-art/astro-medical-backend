# アンチグラビティ（Anti-Gravity）
## 占星術人生経営戦略書 ウェブアプリケーション 仕様書

---

## 📋 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [システム要件](#2-システム要件)
3. [コンテンツ構成](#3-コンテンツ構成)
4. [制作上の問題点](#4-制作上の問題点)
5. [改善すべき点・提案](#5-改善すべき点提案)
6. [技術仕様](#6-技術仕様)
7. [開発ロードマップ](#7-開発ロードマップ)

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
**Strategic Life Navigation System（通称：アンチグラビティ）**

### 1.2 目的
ユーザーの出生データに基づき、MBAホルダーの「人生経営戦略コンサルタント」というペルソナを持つAIが、約50,000文字の超長編鑑定書（PDF）を作成する。

### 1.3 ターゲット
- ビジネスリーダー、起業家、経営者層
- 占星術の初学者を含む一般ユーザー

### 1.4 コアバリュー
占星術を神秘主義ではなく「経営資源の分析ツール」として提供すること。

### 1.5 言語プロトコル
| 項目 | ルール |
|------|--------|
| 日本語第一主義 | 見出しや本文に不要な英語を使用しない |
| カタカナ語の抑制 | 「コミットメント」→「決意」のように適切な日本語を使用 |
| トーン | 翻訳調ではなく、自然で文学的かつ論理的な日本語 |

---

## 2. システム要件

### 2.1 フロントエンド（UI/UX）

#### デザイン方針
- シンプルで洗練されたインターフェース（装飾過多を避ける）

#### 入力フォーム
- 氏名
- 生年月日（年/月/日）
- 出生時間（時/分）
- 出生地（緯度経度の自動取得または選択）

#### 進行画面
| 画面 | 機能 |
|------|------|
| 初期計算結果表示 | 天体位置、ハウス、アングル、サビアンシンボル（度数+1）の一覧表示 |
| ステップ実行UI | プログレスバー付きドキュメント生成。「次へ」ボタンで次セクション生成 |
| 一時停止/完了報告 | 各ステップ終了時に文字数表示、ユーザー承認待ち |
| 出力 | 最終レポート統合PDFダウンロードボタン |

### 2.2 バックエンド / ロジック

#### 天体計算エンジン
**Swiss Ephemeris（スイス・エフェメリス）を必須採用**

| 機能 | 詳細 |
|------|------|
| 正確なカスプ計算 | ハウス区分の精密計算 |
| 天体度数 | 逆行情報等の取得 |
| サビアンシンボル計算 | 度数の小数点以下繰り上げ処理（度数+1のロジック） |

#### AI生成エンジン
- LLM（GPT-4o, Gemini 1.5 Pro等）のAPI連携
- 文字数管理: 生成テキストのトークン数/文字数をカウント
- 3,000文字未満の場合は自動的に拡張指示（「基礎講義」「シナリオ」の加筆）

---

## 3. コンテンツ構成

### 3.1 全体構成（全15ステップ・合計5万文字目標）

各セクションは「6ブロック・執筆メソッド」に基づき出力：

| ブロック | 内容 | 最低文字数 |
|----------|------|-----------|
| 理論背景（Theory） | 天体のビジネス的意味、神話的背景 | 400文字以上 |
| 基礎講義（Lecture） | サインとハウスの性質を詳細に講義 | 1,000文字以上 |
| 配置分析（Analysis） | サイン×ハウスの化学反応を深掘り | 800文字以上 |
| 深層読解（Symbol） | サビアンシンボルの物語的翻訳 | 600文字以上 |
| シナリオ（Scenario） | 失敗/成功の物語（小説形式） | 計1,000文字以上 |
| 提言とワーク（Action） | 具体的行動指針、内省ワーク | 300文字以上 |

### 3.2 セッション構成

| セッション | Step | 章 | 内容 |
|------------|------|-----|------|
| 1. 基盤スペック | 1-A | はじめに / 第1章 | 4元素（火地風水）分析 |
| | 1-B | 第2章 / 第3章 | 3区分 / アングル（AC/MC/IC/DC） |
| 2. 内なるチーム | 2-A | 第4章 | 経営陣：太陽・月 |
| | 2-B | 第5章 | 実務部隊：水星・金星・火星 |
| 3. 社会・変革 | 3-A | 第6章 | 拡大と管理：木星・土星 |
| | 3-B | 第7章 | 変革者：天王星・海王星・冥王星 |
| 4. 独自の物語 | 4-A | 第8章 | 葛藤の統合：アスペクト分析 |
| | 4-B | 第9章-1 | ニッチ戦略：カイロン |
| | 4-C | 第9章-2 | 使命：ドラゴンヘッド |
| 5. ビジネスモデル | 5-A | 第10章-1 | 財源：2ハウス詳細 |
| | 5-B | 第10章-2 | 働き方：6ハウス詳細 |
| | 5-C | 第10章-3 | 天職：10ハウス詳細 |
| 6. 未来予測 | 6-A | 第12章 | 体内時計：プログレス分析 |
| | 6-B | 第13・14章 | 3ヵ年計画：トランジット分析 |
| | 6-C | エピローグ | CEOへの手紙 |

### 3.3 ハイブリッド構成

**「テンプレート（静的）＋ AI生成（動的）」**

| 区分 | 内容 | 実装方法 |
|------|------|----------|
| 固定（Static） | 理論背景、基礎講義 | DBに保存、そのまま表示 |
| 動的（Dynamic） | 配置分析、シナリオ、提言 | AIが都度生成 |

---

## 4. 制作上の問題点

### 4.1 技術的課題

#### ① コンテキスト長（記憶容量）と整合性の維持
| 問題 | リスク |
|------|--------|
| 1セッションごとに前の文脈を全てAIに読ませると、後半になるにつれて入力トークン数が膨大になる | コスト増大や「忘却（前の設定を忘れる）」の発生 |
| 一貫した文体の維持が困難 | 第1章の「強み」と第10章の記述が矛盾する可能性 |

#### ② 生成時間とユーザーの待機ストレス
| 問題 | リスク |
|------|--------|
| 3,000文字×15ステップ＝約50,000文字の生成に時間がかかる | 1ステップあたり数分かかる場合も |
| ユーザーの離脱 | 「フリーズした？」と勘違い、ブラウザのタイムアウトエラー |

#### ③ PDF生成の技術的難易度
| 問題 | リスク |
|------|--------|
| 5万文字の日本語PDF（図表入り、美しい見出し付き）をフロントエンドだけで生成 | 負荷が高く、レイアウト崩れが起きやすい |
| フォント問題 | ダウンロードしたPDFのフォントが崩れる、ページ区切りが不自然 |

#### ④ Swiss Ephemerisのサーバー負荷と実装
| 問題 | リスク |
|------|--------|
| C言語ベースのライブラリ | サーバーレス環境では導入に知識が必要 |
| 天文暦データファイル | サーバーに置く必要があり、軽量化しすぎると精度が出ない |

#### ⑤ 天体計算の精度問題
| 問題 | リスク |
|------|--------|
| 度数のずれ | サビアンシンボルの読み取りに影響 |
| タイムゾーン/サマータイム | 正確な度数が出ない場合がある |

#### ⑥ 意味段落の断絶問題
| 問題 | リスク |
|------|--------|
| 分割生成による文脈切れ | 各セクション間のつながりが不自然 |
| 一気に計算させない方針との兼ね合い | 品質を保ちつつ効率的に生成する困難さ |

### 4.2 UX/UI課題

#### ① ユーザー確認の難しさ
- 出生地の緯度経度確認: ユーザーは判断できない場合が多い
- 出生時間不明の処理: デフォルト設定の必要性

#### ② 進捗の可視化
- 長時間の生成プロセスでのユーザー体験
- 中断・再開機能の必要性

### 4.3 コンテンツ課題

#### ① 文字数の不安定さ
- AIの生成文字数が一定しない
- 基準値未満時のリカバリー処理の自動化

#### ② 未来予測の限界
- プログレス/トランジットの解釈精度
- AIに日付を計算させると間違える可能性

---

## 5. 改善すべき点・提案

### 5.1 アーキテクチャ改善

#### A. 「ステートレス設計」による一貫性維持

```
【常に渡す情報】
- ホロスコープの天体配置データ（JSON形式で軽量化）
- 現在のステップ番号と章タイトル

【その章だけ渡す情報】
- 直前1ステップの要約（300文字程度）
- その章で扱う天体・ハウスの情報のみ

【最終まとめ時のみ】
- 各章の要約を自動生成して蓄積、最後に全要約を渡す
```

#### B. 「人物像サマリー」の活用
- Step 1（4元素などの基本分析）完了時点で「ユーザープロファイル（500文字）」を生成
- System Messageに固定し、以降全セッションで参照

### 5.2 UX改善

#### A. 進捗の可視化とストリーミング表示

```
━━━━━━━━━━━━━━━━━━━━ 35% 完了
第5章 / 全15章｜累計 17,500文字
```

- 生成文章をリアルタイムでタイプライター風に表示
- 待ち時間の体感を短縮

#### B. 中断・再開機能
- 各ステップ完了時にデータベースに保存
- 途中でブラウザを閉じても再開可能
- ユーザーID（またはLocalStorage）に紐づけ

#### C. 自動進行オプション
- 「自動で最後まで生成する」ボタンを用意
- バックグラウンドで全章生成、完成したら通知

### 5.3 文字数管理の改善

#### 3段階のリカバリーシステム

```python
# 擬似コード
def generate_section(prompt):
    result = llm.generate(prompt)
    char_count = len(result)
    
    if char_count < 2500:
        # 不足時：具体例追加を指示
        result += llm.generate("上記に具体的なエピソードを500文字追加して")
    elif char_count > 4000:
        # 過剰時：要点を絞る
        result = llm.generate(f"以下を3000文字に要約して：{result}")
    
    return result
```

- ユーザーには最終結果だけ見せる
- 内部でループ処理を完結

### 5.4 意味段落の断絶対策

#### A. 「橋渡し文」の自動挿入
- 各ステップの冒頭: 「前章では○○を見ました。本章では△△に進みます」
- 各ステップの末尾: 「次章への伏線」を1文入れるようプロンプトに明記

#### B. 一貫性チェック用の「人物像サマリー」
- Step 2終了時点で「この人の基本的な人物像」を500文字で生成・保存
- 以降の全ステップでこのサマリーを参照させる

### 5.5 PDF生成の改善

#### バックエンドでのPDF生成を推奨

| 技術 | 特徴 |
|------|------|
| Python: ReportLab | 5万文字でも対応可能、日本語フォント埋め込み |
| Node.js: Puppeteer | ブラウザベースでレイアウト忠実再現 |

- 目次、ページ番号、綺麗なフォント埋め込みを確実に行える
- 「電子書籍」としてのクオリティを担保

### 5.6 天体計算の改善

#### A. 地図連携による確認
- Google Maps API等と連携し、入力された都市名から「地図（ピン）」を表示
- 出生時間不明の場合: 12:00設定などのデフォルト処理を明示

#### B. 計算とAIの役割分担

| 担当 | 内容 |
|------|------|
| Python（SwissEph） | 「2026年3月15日〜4月20日まで火星が7ハウス」という事実データを計算 |
| AI | 「上記期間は、対人関係でトラブルが起きやすいので注意」という解釈を生成 |

### 5.7 根本的な設計変更案

#### A. 文字数の見直し

| 構成案 | 文字数 | メリット |
|--------|--------|----------|
| 現行案 | 50,000字 | 圧倒的ボリューム感 |
| 代替案A | 25,000字 + 音声解説 | 読みやすさと没入感の両立 |
| 代替案B | 15,000字コア + 詳細PDF別添 | 本編は読みやすく、深掘りは別途 |

#### B. 「テンプレート＋カスタム」のハイブリッド強化
- 各章の理論背景・基礎講義部分は事前に人間が監修
- AIが生成するのは「配置分析」「シナリオ」など個人固有の部分のみ
- 品質安定＋トークン節約＋生成速度向上

---

## 6. 技術仕様

### 6.1 システムアーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                     フロントエンド                           │
│  (React/Vue.js/Next.js)                                     │
│  - 入力フォーム                                              │
│  - プログレスバー                                            │
│  - ストリーミング表示                                        │
│  - PDFダウンロード                                           │
└─────────────────────┬───────────────────────────────────────┘
                      │ API通信
┌─────────────────────▼───────────────────────────────────────┐
│                     バックエンド                             │
│  (Python FastAPI/Flask)                                     │
│  - PySwissEph (天体計算)                                     │
│  - LLM API連携 (GPT-4o/Gemini)                              │
│  - ReportLab (PDF生成)                                      │
└─────────────────────┬───────────────────────────────────────┘
                      │ データ連携
┌─────────────────────▼───────────────────────────────────────┐
│                     データベース                             │
│  (Firestore/PostgreSQL)                                     │
│  - 固定テンプレート格納                                      │
│  - ユーザー進行状況保存                                      │
│  - セッション管理                                            │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 推奨技術スタック

| レイヤー | 推奨技術 | 理由 |
|----------|----------|------|
| フロントエンド | Next.js | Vercel等でのホスティングに最適 |
| バックエンド | Python (FastAPI) | PySwissEph, ReportLabが充実 |
| AI連携 | OpenAI API (GPT-4o) / Gemini API | 長文生成能力 |
| データベース | Firestore (初期) | 軽量、JSONとの親和性 |
| PDF生成 | ReportLab | 日本語対応、大量文字対応 |

### 6.3 データ構造

#### マスターコンテンツJSON構造

```json
{
  "app_metadata": {
    "title": "Strategic Life Navigation (Anti-Gravity)",
    "version": "1.0.0"
  },
  "system_settings": {
    "role_definition": "MBAを持つ人生経営戦略コンサルタント",
    "tone_of_voice": {...}
  },
  "sessions": [
    {
      "session_id": 1,
      "title": "基盤スペック",
      "steps": [
        {
          "step_id": "1-A",
          "chapter_title": "第1章：4元素",
          "static_lecture": "固定テキスト...",
          "dynamic_prompt": {
            "instruction": "AIへの指示...",
            "variables_required": ["fire_count", "earth_count", ...],
            "structure_requirement": [...]
          }
        }
      ]
    }
  ]
}
```

---

## 7. 開発ロードマップ

### Phase 1: コアエンジンの開発（1〜2週間）

| タスク | 詳細 |
|--------|------|
| Swiss Ephemeris実装 | 全天体・ハウス・アスペクト・カイロン・ドラゴンヘッドの正確な出力 |
| サビアン計算機 | 度数繰り上げロジック実装 |
| JSON整備 | 全章分のテキストデータをJSON化 |

### Phase 2: ハイブリッド生成の結合（1〜2週間）

| タスク | 詳細 |
|--------|------|
| プロンプトエンジニアリング | 第1章〜第14章の詳細指示調整 |
| 結合テスト | 「固定文」＋「AI生成文」の違和感チェック |
| 文字数リカバリー | 自動拡張・要約ロジック |

### Phase 3: UI構築とPDF化（2週間）

| タスク | 詳細 |
|--------|------|
| フロントエンド実装 | 入力フォーム、プログレスバー、「次へ」ボタン |
| PDF生成エンジン | 全テキスト結合、目次、表紙、ページ番号 |
| ストリーミング表示 | タイプライター効果実装 |

### Phase 4: テストと微調整（1週間）

| タスク | 詳細 |
|--------|------|
| 異常系テスト | 出生時間不明、極端な緯度での挙動確認 |
| 文字数調整 | 5万文字目標達成チューニング |
| UXテスト | ユーザビリティ検証 |

---

## 8. 付録：固定テキスト例（第4章：太陽・月）

### 理論背景（Static）

```
【理論背景 (Theory)】
～太陽の「目的」と、月の「欲求」～

占星術において、太陽と月は「ライツ（発光体）」と呼ばれ、別格の扱いを受けます。

● 太陽 (The Sun) = CEO（最高経営責任者）
役割: 企業の「ビジョン」「経営理念」「対外的な公約」を決定する。
性質: 意識的、能動的、父性、未来志向。「こうありたい」という意志。

● 月 (The Moon) = CFO（最高財務責任者）兼 CHRO
役割: 企業の「資金繰り（エネルギー）」と「社員の士気（感情）」を管理する。
性質: 無意識的、受動的、母性、過去・現在志向。「こうしたい（好き/嫌い）」という本能。

理想的な経営とは、「太陽が掲げた困難なビジョンを、月が納得して支えている状態」です。
```

### AI指示書（Dynamic）

```json
{
  "instruction": "ユーザーの太陽と月をCEOとCFOに例えて分析してください。",
  "variables_required": [
    "sun_sign", "sun_house", "sun_sabi_symbol",
    "moon_sign", "moon_house", "moon_sabi_symbol",
    "sun_moon_aspect"
  ],
  "structure_requirement": [
    "2. 【基礎講義】: 太陽（CEO）と月（CFO）のキャラクター、ハウスの場所を解説",
    "3. 【配置分析】: CEOとCFOの関係性分析、統合戦略の提案",
    "4. 【深層読解】: サビアンシンボルによるCEOの真の意図",
    "5. 【シナリオ】: 💀失敗と ✨成功の物語",
    "6. 【提言とワーク】: 太陽と月を統合するためのルーチン"
  ]
}
```

---

## 9. まとめ

本仕様書は、ダイアログで検討された「アンチグラビティ」占星術ウェブアプリの全容をまとめたものです。

### 重要決定事項
1. **ハイブリッド構成採用**: 固定テキスト（理論）+ AI生成（分析）
2. **Swiss Ephemeris必須**: 精密な天体計算のため
3. **ソーラーリターン不採用**: スコープ外とする
4. **PDF出力機能必須**: サーバーサイドでの生成推奨
5. **5万文字目標**: 各ステップ3,000文字を基準

### 次のアクション
1. 固定テキスト（テンプレート）の執筆・用意
2. JSONマスターデータの完成
3. Phase 1（コアエンジン）の開発開始

---

*作成日: 2024年*
*バージョン: 1.0.0*
